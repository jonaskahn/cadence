# MongoDB Production Configuration for Cadence
# Based on MongoDB 8.0.19 with production optimizations

# Network interfaces
net:
  port: 27017
  bindIp: 0.0.0.0
  maxIncomingConnections: 500
  # Enable TLS/SSL for production
  tls:
    mode: requireTLS
    certificateKeyFile: /etc/ssl/mongodb/mongodb.pem
    CAFile: /etc/ssl/mongodb/ca.pem
    allowConnectionsWithoutCertificates: false
    allowInvalidCertificates: false

# Storage engine
storage:
  dbPath: /data/db
  journal:
    enabled: true
    commitIntervalMs: 100
  directoryPerDB: true
  wiredTiger:
    engineConfig:
      cacheSizeGB: 2                    # 50% of system RAM (for 4GB system)
      journalCompressor: snappy
      directoryForIndexes: true
    collectionConfig:
      blockCompressor: snappy
    indexConfig:
      prefixCompression: true

# System log
systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log
  logRotate: reopen
  timeStampFormat: iso8601-utc
  component:
    accessControl:
      verbosity: 1
    command:
      verbosity: 1
    query:
      verbosity: 1
    replication:
      verbosity: 1
    storage:
      verbosity: 1
      journal:
        verbosity: 1
    write:
      verbosity: 1

# Process management
processManagement:
  fork: false
  pidFilePath: /var/run/mongodb/mongod.pid
  timeZoneInfo: /usr/share/zoneinfo

# Security
security:
  authorization: enabled
  # Enable for LDAP/Kerberos
  # ldap:
  #   servers: "ldap.example.com"
  #   transportSecurity: tls
  # For encrypted storage at rest (Enterprise)
  # enableEncryption: true
  # encryptionKeyFile: /path/to/keyfile

# Replication (for replica set configuration)
# replication:
#   replSetName: cadence-rs
#   oplogSizeMB: 10240

# Sharding (for sharded cluster)
# sharding:
#   clusterRole: shardsvr

# Operation profiling
operationProfiling:
  mode: slowOp
  slowOpThresholdMs: 1000
  slowOpSampleRate: 1.0

# Set parameters
setParameter:
  enableLocalhostAuthBypass: false
  authenticationMechanisms: SCRAM-SHA-256
  diagnosticDataCollectionEnabled: true
  # Connection pool
  maxConnsPerHost: 200
  # Query execution
  internalQueryExecMaxBlockingSortBytes: 33554432
  # Aggregation
  internalPipelineLengthLimit: 1000
  # Write concern
  writeConcernMajorityJournalDefault: true

# Audit log (Enterprise edition)
# auditLog:
#   destination: file
#   format: JSON
#   path: /var/log/mongodb/audit.json
#   filter: '{ atype: "authenticate", "param.db": "admin" }'
